**"설명과 사진의 모든 출처는 [다음 블로그](https://subicura.com/2017/01/19/docker-guide-for-beginners-1.html)에 있고 단순히 베끼면서 공부했기 때문에 99% 동일합니다"** **+ "생활코딩 동영상"**

# docker(도커)

**docker는 컨테이너 기반의 오픈소스 가상화 플랫폼** 이다. 그럼 컨테이너란 무엇인가? 컨테이너란 격리된 공간에서 프로세스가 동작하는 기술로 가상화 기술의 하나이지만 기존의 방식과는 차이가 있다. 기존의 가상화 방식은 VMWare나 VirtualBox 같이 호스트 OS 위에 게스트 OS를 가상화하는 방식이었다. 이 방식은 여러가지 OS를 가상화 할 수 있고 비교적 사용법이 간단하지만 무겁고 느려서 운영 환경에선 사용할 수 없다.

이후 반가상화가 등장하기도 했지만 추가적인 OS를 설치하여 가상화하는 방법은 성능문제가 있었기 때문에 이를 개선하기 위해 프로세스를 격리하는 방식이 등장한다.

<img src="https://subicura.com/assets/article_images/2017-01-19-docker-guide-for-beginners-1/vm-vs-docker.png">

> *가상머신과 도커*

리눅스에서는 이 방식을 리눅스 컨테이너라고 하고 단순히 프로세스를 격리시키기 때문에 가볍고 빠르게 동작한다. CPU나 메모리는 프로세스가 필요한 만큼만 추가로 사용하고 성능적으로도 거의 손실이 없다.

하나의 서버에 여러개의 컨테이너를 실행하면 서로 영향을 미치지 않고 독립적으로 실행되어 마치 가벼운 VM을 사용하는 느낌을 준다. 실행중인 컨테이너에 접속하여 명령어를 입력할 수도 있고 `apt-get`이나 `yum`으로 패키지를 설치할 수 있으며 사용자도 추가하고 여러개의 프로세스를 백그라운드로 실행할 수 있다. CPU나 메모리의 사용량을 제한할 수 있고 호스트의 특정 포트와 연결하거나 호스트의 특정 디렉토리를 내부 디렉토리인 것처럼 사용할 수도 있다.

새로운 컨테이너를 만드는데 걸리는 시간은 1~2초밖에 안된다.

# Image(이미지)

이미지는 컨테이너 실행에 필요한 파일과 설정값들을 포함하고 있는 것 으로 상태값을 가지지 않고 변하지 않는다. 컨테이너는 이미지를 실행한 상태라고 볼 수 있고 추가되거나 변하는 값은 컨테이너에 저장된다. 같은 이미지에서 여러개의 컨테이너를 생성할 수 있고 컨테이너의 상태가 바뀌거나 컨테이너가 삭제되더라도 이미지는 변하지 않고 그대로 남아있다.

<img src="https://subicura.com/assets/article_images/2017-01-19-docker-guide-for-beginners-1/docker-image.png">

* ubuntu 이미지 : ubuntu를 실행하기 위한 모든 파일을 가짐
* MySQL 이미지 : debian을 기반으로 MySQL을 실행하는데 필요한 파일과 실행 명령어, 포트 정보들을 가지고 있다.
* Gitlab 이미지 : cent OS를 기반으로 ruby, go, database, redis, gitlab source, nginx 등을 가지고 있다.

말 그대로 이미지는 컨테이너를 실행하기 위한 모든 정보를 가지고 있기 때문에 더 이상 의존성 파일을 컴파일하고 이것저것 설치할 필요가 없다. 새로운 서버가 추가되면 미리 만들어 놓은 이미지를 다운받아 컨테이너를 생성만 하면 된다. 한 서버에 여러개의 컨테이너를 실행할 수 있고 수백대의 서버도 문제가 없다.

<img src="https://subicura.com/assets/article_images/2017-01-19-docker-guide-for-beginners-1/docker-store.png">

> *Docker store*

docker 이미지는 Docker hub에 등록하거나 Docker Registry 저장소를 직접 만들어 관리할 수 있다. 현재 공개된 docker 이미지는 50만개가 넘고 docker hub의 이미지 다운로드 수는 80억회에 이른다. 누구나 쉽게 이미지를 만들고 배포할 수 있다.

# 생활코딩 docker 강의([유튜브](https://www.youtube.com/watch?v=Bhzz9E3xuXY))

* ubuntu 이미지는 ubuntu 전체를 받아오는 것이 아니라 리눅스 커널을 제외한 라이브러리와 패키지 매니저를 받아오는 것이다.
* docker는 lib container라는 기술을 사용하며 기존에는 LXC(Linux Container)를 사용했는데 이 기술은 기존에 리눅스 커널에 포함된 기술이다.
* docker는 git과 github의 관계와 같이 docker hub의 관계와 같지만, docker와 docker hub 모두 같은 회사가 만들었다.
* `docker images` : 현재 docker에 어떤 이미지들이 있는지 보여주며 이미지의 이름,버전,해쉬ID, 만들어진 날짜, 용량 등을 보여준다.
* `docker pull "이미지 이름"` : 해당 이미지를 받아온다.
* `docker search "이미지 이름"` : 해당 이미지에 대한 모든 버전을 보여주며 앞에 ID가 없는 것이 docker에서 공식적으로 지원하는 이미지이다.  명령어가 아닌 다른 방법을 사용하려면 홈페이지에 직접 가서 검색해보면 된다.
* `docker run -i -t "이미지 이름" /bin/bash` : 해당 이미지에 대한 컨테이너 생성 후에 실행하는 것. i는 interactive의 약자로 입출력을 가능하게 해주며 t는 가상 터미널 환경을 에뮬레이션 해주겠다는 것, bash를 실행시킬 수 있음.
* /bin/bash의 의미는 기존의 VM과는 다르게 직접 해당 실행파일을 실행시켜주어야 하기 때문에 해당 컨테이너의 실행 파일을 시켜줬다는 의미이다.
* 위의 명령어를 실행하게 되면 해당 컨테이너 안에 들어오게 된 것이고 bash 위에서 동작하고 있는 개념이 된다. (ls를 하게 되면 컨테이너 안에 있는 요소들을 봄으로 확인할 수 있다.)
* 만약에 ubuntu 이미지를 다운받아 컨테이너로 실행한다고 하면 git을 설치할 수 있는데 이 git은 컨테이너 안에서만 유용한 것이다.
* `exit` : 실행파일을 종료시키며 컨테이너도 같이 종료된다.
* `docker ps` : 실행하고 있는 컨테이너들을 보여준다.
* `docker ps -a` : 종료된 컨테이너까지 보여준다.
* `docker start 이름` : 해당 이름으로 이미지에 대한 컨테이너를 생성하고 실행한다는 의미로 이름을 정해주지 않으면 docker가 자동으로 생성하며 `run`과의 차이점은 실행과 동시에 그 안으로 들어가진 않는다는 것이다.
* `docker attach 이름 + 엔터` : `start`로 실행한 컨테이너에 들어가기 위해서 실행하는 명령으로 엔터를 입력해야 컨테이너의 bash shell로 들어간다.
* `Ctrl+p+q` : `exit`을 하면 컨테이너가 종료되지만 다음 단축키를 쓰면 종료가 안 된 상태로 빠져나올 수 있다. (docker의 단축키가 아니라 bash shell의 단축키)
* `docker stop 이름` : 해당 이름에 대한 컨테이너를 종료시킨다.
* docker는 종료된 컨테이너라 하더라도 어쩌피 띄워서 사용할 것이기 때문에 삭제하지 않는다. 삭제하기 위해선 `docker rm 이름` 을 쳐주면 된다.
* `docker rmi "이미지이름"` : 위에선 컨테이너를 지우는 명령어였고 이건 remove image로 이미지를 지우는 명령어이다.
* `docker pull "이미지이름":latest` : 해당 이미지를 받으려고 하는데 버전을 모르겠으면 latest를 붙여줘서 최신 버전을 받을 수 있다.
* `docker run -d --name "이름" "이미지이름"` : ubuntu 이미지에 대한 컨테이너를 실행할 때는 bash shell을 실행해서 입출력을 가능하게 하기 위하여 `-i`와 `-t` 옵션을 줬지만 nginx는 단순 daemon이므로 백그라운드에서 실행하는 옵션인 `-d`만 주면 되고 사용자가 자체적으로 이름을 주고 싶다면 `--name`을 해주면 된다. 만약 기존 운영체제의 포트와 충돌한다면 `-p` 옵션으로 포트포워딩도 가능하다.